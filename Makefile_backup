all=main
CFLAGS=-g3 -std=c++11
INCLUDE=-I. -I./include
SOURCES=epoll.cpp Util.cpp httpData.cpp
SRC_DIR=./src
CXX=g++
LINKER=-lpthread
OBJ=main.o $(SRC_DIR)/epoll.o $(SRC_DIR)/Util.o $(SRC_DIR)/httpData.o $(SRC_DIR)/server.o
OBJ_D=main.o epoll.o Util.o httpData.o server.o shit.o
#DEPXXX=$(SRC_DIR:.o=.d)
#all: $(OBJ) 
all: $(OBJ_D) 
	$(CXX) $(CFLAGS) $(INCLUDE) -o $@ $^ $(LINKER)
#OBJ1:$(OBJ)

#-include $($(SRC_DIR):.cpp=.d)
DEPDIR := .dddd
DEPFLAGS =-MD# -MT $@ -MD -MP -MF $(DEPDIR)/$*.Td
SRCS:=epoll.cpp httpData.cpp Util.cpp server.cpp #$(wildcard: $(SRC_DIR)/.cpp)
# object files, auto generated from source files
OBJS := $(patsubst %,$(SRC_DIR)/%.o,$(basename $(SRCS))) $(SRC_DIR)/main.o
# # dependency files, auto generated from source files
DEPS := $(patsubst %,$(DEPDIR)/%.d,$(basename $(SRCS))) $(DEPDIR)/main.d
DEPS_BAR:=main.d $(patsubst %.o,%.d,$(SRC_DIR)/%.d)
# precompile step
 PRECOMPILE =
# POSTCOMPILE=
# # postcompile step
 POSTCOMPILE = mv -f $(DEPDIR)/$*.Td $(DEPDIR)/$*.d
# POSTCOMPILE = rm -f  $(DEPS_BAR)
#FILE=$(shell mkdir -p $(dir $(OBJS)) >/dev/null)
#$(shell mkdir -p $(dir $(DEPS)) >/dev/null)
OBJS1:$(OBJS)
	$^
DEPS1:$(DEPS)
	$^
FILE1:$(FILE)
	echo $^
	

#$(SRC_DIR)/%.o:$(SRC_DIR)/%.cpp $(DEPS_BAR)
OBJ_D:$(SRC_DIR)/%.cpp $(DEPS)/%.d
#$(SRC_DIR)/%.o:$(SRC_DIR)/%.cpp 
	$(PRECOMPILE)
	$(CXX) $(CFLAGS) $(INCLUDE) -MM -MF $(patsubst $(SRC_DIR)/%.o,$(SRC_DIR)/%.d,$@) -c $<  -o $@
	#$(CXX) $(CFLAGS) $(INCLUDE) $(DEPFLAGS) -c $<  -o $@
#	$(CXX) $(CFLAGS) $(INCLUDE) -MD -c $<  -o $@
	$(POSTCOMPILE)
#main.o:main.cpp $(DEPDIR)/%.d
#main.o:main.cpp $(DEPDIR)/%.d
maini.o:main.cpp $(DEPS_BAR)
	$(PRECOMPILE)
	$(CXX) $(CFLAGS) $(INCLUDE) -MD -c $<  -o $@
	$(POSTCOMPILE)
$(DEPS_BAR): ;
.PRECIOUS = $(DEPDIR)/%.d
-include $(DEPS)
#-include $(OBJ_D:.o=.d)
#-include $(SRC_DIR:.o=.d)
#include  src/httpData.d
